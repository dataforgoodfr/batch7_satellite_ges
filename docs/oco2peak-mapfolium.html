---

title: OCO2 - Display map and capture zone around the peak


keywords: fastai
sidebar: home_sidebar



nb_path: "notebooks/oco2peak-mapfolium.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/oco2peak-mapfolium.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="ch">#!apt-get install swiftclient</span>
<span class="c1">#!pip install geopandas</span>

<span class="c1">#Solve geopandas rtee problemm for sjoin</span>
<span class="c1">#!apt-get install -y libspatialindex-dev</span>
<span class="c1">#!pip install rtree</span>

<span class="c1">#!pip install nbdev</span>

<span class="c1"># If the graph do not display, try :</span>
<span class="c1">#!jupyter labextension install jupyterlab-plotly</span>
<span class="c1"># You may have to upgrade Node and Jupyter</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">reload_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="c1">#%matplotlib inline</span>
<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Introduction">Introduction<a class="anchor-link" href="#Introduction"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config_path</span> <span class="o">=</span> <span class="s2">&quot;../configs/config.json&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_data_file</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_data_file</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">swift_con</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">user</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;swift_storage&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
    <span class="n">key</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;swift_storage&#39;</span><span class="p">][</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
    <span class="n">auth_url</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;swift_storage&#39;</span><span class="p">][</span><span class="s1">&#39;auth_url&#39;</span><span class="p">]</span>
    <span class="n">tenant_name</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;swift_storage&#39;</span><span class="p">][</span><span class="s1">&#39;tenant_name&#39;</span><span class="p">]</span>
    <span class="n">auth_version</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;swift_storage&#39;</span><span class="p">][</span><span class="s1">&#39;auth_version&#39;</span><span class="p">]</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;swift_storage&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">swiftclient</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
                                  <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                                  <span class="n">authurl</span><span class="o">=</span><span class="n">auth_url</span><span class="p">,</span>
                                  <span class="n">os_options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
                                  <span class="n">tenant_name</span><span class="o">=</span><span class="n">tenant_name</span><span class="p">,</span>
                                  <span class="n">auth_version</span><span class="o">=</span><span class="n">auth_version</span><span class="p">)</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">swift_con</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Retrieve-Data">Retrieve Data<a class="anchor-link" href="#Retrieve-Data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-peaks-with-captured-inventory">Gaussian peaks with captured inventory<a class="anchor-link" href="#Gaussian-peaks-with-captured-inventory"> </a></h3><p>The CSV contains the gaussian peaks unfiltered, spatially joined with inventory data. The CSV is stored on the GitHub.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path_peaks</span> <span class="o">=</span> <span class="s2">&quot;../dataset/peaks_and_invent/peaks_and_invent_1410.csv&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_peaks</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">loads</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;epsg:4326&#39;</span><span class="p">}</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sounding_id</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>orbit</th>
      <th>slope</th>
      <th>intercept</th>
      <th>amplitude</th>
      <th>sigma</th>
      <th>delta</th>
      <th>R</th>
      <th>...</th>
      <th>index_Iron and steel</th>
      <th>number_Iron and steel</th>
      <th>index_Combustion</th>
      <th>number_Combustion</th>
      <th>index_Non ferrous metals</th>
      <th>number_Non ferrous metals</th>
      <th>index_Mineral oil</th>
      <th>number_Mineral oil</th>
      <th>index_Coke ovens</th>
      <th>number_Coke ovens</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2014100205581236</td>
      <td>39.072670</td>
      <td>107.781944</td>
      <td>1339</td>
      <td>0.004097</td>
      <td>396.359779</td>
      <td>71.886003</td>
      <td>27.375463</td>
      <td>1.047594</td>
      <td>0.524609</td>
      <td>...</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2014100205581377</td>
      <td>39.148392</td>
      <td>107.769295</td>
      <td>1339</td>
      <td>0.003033</td>
      <td>396.212893</td>
      <td>100.136482</td>
      <td>16.587700</td>
      <td>2.408331</td>
      <td>0.653852</td>
      <td>...</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2014100205581436</td>
      <td>39.192081</td>
      <td>107.744568</td>
      <td>1339</td>
      <td>0.002226</td>
      <td>396.212991</td>
      <td>112.860315</td>
      <td>11.120307</td>
      <td>4.048877</td>
      <td>0.788405</td>
      <td>...</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2014100205581505</td>
      <td>39.235714</td>
      <td>107.719788</td>
      <td>1339</td>
      <td>0.001005</td>
      <td>396.234629</td>
      <td>123.853792</td>
      <td>9.757608</td>
      <td>5.063794</td>
      <td>0.934664</td>
      <td>...</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2014100205581575</td>
      <td>39.275524</td>
      <td>107.707375</td>
      <td>1339</td>
      <td>-0.000225</td>
      <td>396.247235</td>
      <td>125.116723</td>
      <td>10.329770</td>
      <td>4.832087</td>
      <td>0.900564</td>
      <td>...</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
      <td>[nan]</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 48 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inventory-Data">Inventory Data<a class="anchor-link" href="#Inventory-Data"> </a></h3><p>The CSV is stored on the GitHub.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;2016&quot;</span>

<span class="n">path_invent</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/dataforgoodfr/batch7_satellite_ges/master/dataset/Output</span><span class="si">%20i</span><span class="s2">nventory</span><span class="si">%20d</span><span class="s2">ata/Merge</span><span class="si">%20o</span><span class="s2">f%20peaks/CO2_emissions_peaks_merged_&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;.csv&quot;</span>
<span class="n">invent</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_invent</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">invent</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">invent</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">invent</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">invent</span><span class="o">.</span><span class="n">latitude</span><span class="p">))</span>
<span class="n">invent</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;epsg:4326&#39;</span><span class="p">}</span>

<span class="n">invent</span> <span class="o">=</span> <span class="n">invent</span><span class="p">[</span><span class="n">invent</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
<span class="n">invent</span> <span class="o">=</span> <span class="n">invent</span><span class="p">[</span><span class="n">invent</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
<span class="n">invent</span> <span class="o">=</span> <span class="n">invent</span><span class="p">[</span><span class="n">invent</span><span class="p">[</span><span class="s1">&#39;CO2/CO2e emissions (in tonnes per year)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>

<span class="n">invent_types</span> <span class="o">=</span> <span class="n">invent</span><span class="p">[</span><span class="s1">&#39;CO2/CO2e emissions source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Types of inventory: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">invent_types</span><span class="p">)</span>

<span class="n">invent</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Types of inventory: 
[&#39;City&#39; &#39;Oil power plant&#39; &#39;Coal power plant&#39; &#39;Gas power plant&#39;
 &#39;Cement and Lime&#39; &#39;Glass&#39; &#39;Power and heat&#39; &#39;Ceramics&#39; &#39;Pulp and paper&#39;
 &#39;Chemicals&#39; &#39;Iron and steel&#39; &#39;Combustion&#39; &#39;Non ferrous metals&#39;
 &#39;Mineral oil&#39; &#39;Coke ovens&#39;]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>latitude</th>
      <th>longitude</th>
      <th>Data source</th>
      <th>CO2/CO2e emissions source</th>
      <th>CO2/CO2e emissions (in tonnes per year)</th>
      <th>CO2 or CO2e</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>43.653226</td>
      <td>-79.383184</td>
      <td>Opendatasoft</td>
      <td>City</td>
      <td>16151019.00</td>
      <td>CO2</td>
      <td>POINT (-79.3831843 43.653226)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>45.802578</td>
      <td>9.086356</td>
      <td>Opendatasoft</td>
      <td>City</td>
      <td>3728678.00</td>
      <td>CO2</td>
      <td>POINT (9.086356 45.802578)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>37.668900</td>
      <td>-122.080800</td>
      <td>Opendatasoft</td>
      <td>City</td>
      <td>861854.00</td>
      <td>CO2e</td>
      <td>POINT (-122.0808 37.6689)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>35.689634</td>
      <td>139.692101</td>
      <td>Opendatasoft</td>
      <td>City</td>
      <td>27611000.00</td>
      <td>CO2e</td>
      <td>POINT (139.6921007 35.6896342)</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-10.249091</td>
      <td>-48.324286</td>
      <td>Opendatasoft</td>
      <td>City</td>
      <td>589055.31</td>
      <td>CO2e</td>
      <td>POINT (-48.324286 -10.249091)</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Map-Visualization-&amp;-Statistics-methods">Map Visualization &amp; Statistics methods<a class="anchor-link" href="#Map-Visualization-&amp;-Statistics-methods"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inventory-Map">Inventory Map<a class="anchor-link" href="#Inventory-Map"> </a></h3><p>To display only the inventory data on a folium map:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">invent_types</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cl</span><span class="p">)]</span><span class="o">=</span><span class="n">cl</span>
    
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;City&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;City&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="inventory_map_only" class="doc_header"><code>inventory_map_only</code><a href="https://github.com/dataforgoodfr/batch7_satellite_ges/tree/master/oco2peak/oco2mapfolium.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>inventory_map_only</code>(<strong><code>invent</code></strong>)</p>
</blockquote>
<p>Create map with inventory only
:param invent: GeoDataFrame, Dataframe containing all inventory.
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Draw-source-zone">Draw source zone<a class="anchor-link" href="#Draw-source-zone"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="peaks_capture_map" class="doc_header"><code>peaks_capture_map</code><a href="https://github.com/dataforgoodfr/batch7_satellite_ges/tree/master/oco2peak/oco2mapfolium.py#L173" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>peaks_capture_map</code>(<strong><code>peaks</code></strong>, <strong><code>invent</code></strong>, <strong><code>mapbox_token</code></strong>=<em><code>None</code></em>, <strong><code>month</code></strong>=<em><code>'1908'</code></em>)</p>
</blockquote>
<p>Create map with peaks (marker + capture zone) and inventory
:param peaks: GeoDataFrame, Dataframe containing the peaks we want to display.
:param plants: GeoDataFrame, Dataframe containing all registered plants.
:param plants_coal: GeoDataFrame, Dataframe containing all registered coal plants.
:param cities: GeoDataFrame, Dataframe containing all registered big cities.
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Examples-and-Sanity-Checks">Examples and Sanity Checks<a class="anchor-link" href="#Examples-and-Sanity-Checks"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Map-Examples">Map Examples<a class="anchor-link" href="#Map-Examples"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inventory_map_only</span><span class="p">(</span><span class="n">invent</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Saving 2016 inventory map...
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-11-c57624a10d5c&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>inventory_map_only<span class="ansi-blue-fg">(</span>invent<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-9-0da87f293cd0&gt;</span> in <span class="ansi-cyan-fg">inventory_map_only</span><span class="ansi-blue-fg">(invent)</span>
<span class="ansi-green-intense-fg ansi-bold">     44</span> 
<span class="ansi-green-intense-fg ansi-bold">     45</span>     print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Saving &#34;</span><span class="ansi-blue-fg">+</span>year<span class="ansi-blue-fg">+</span> <span class="ansi-blue-fg">&#34; inventory map...&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 46</span><span class="ansi-red-fg">     </span>inventory_map<span class="ansi-blue-fg">.</span>save<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;../front/invent_maps/inventory_map_&#34;</span><span class="ansi-blue-fg">+</span>year<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#34;.html&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     47</span>     <span class="ansi-green-fg">return</span> inventory_map

<span class="ansi-green-fg">/media/data-nvme/dev/anaconda3/lib/python3.7/site-packages/branca/element.py</span> in <span class="ansi-cyan-fg">save</span><span class="ansi-blue-fg">(self, outfile, close_file, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    162</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    163</span>         <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>outfile<span class="ansi-blue-fg">,</span> text_type<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">or</span> isinstance<span class="ansi-blue-fg">(</span>outfile<span class="ansi-blue-fg">,</span> binary_type<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 164</span><span class="ansi-red-fg">             </span>fid <span class="ansi-blue-fg">=</span> open<span class="ansi-blue-fg">(</span>outfile<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;wb&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    165</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    166</span>             fid <span class="ansi-blue-fg">=</span> outfile

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../front/invent_maps/inventory_map_2016.html&#39;</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config_file</span> <span class="o">=</span> <span class="s2">&quot;../configs/config.json&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_data_file</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_data_file</span><span class="p">)</span>
<span class="n">mapbox_token</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;mapbox_token&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">peaks_capture_map</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">45</span><span class="p">],</span> <span class="n">invent</span><span class="p">,</span> <span class="n">mapbox_token</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="peaks_capture_map" class="doc_header"><code>peaks_capture_map</code><a href="https://github.com/dataforgoodfr/batch7_satellite_ges/tree/master/oco2peak/oco2mapfolium.py#L173" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>peaks_capture_map</code>(<strong><code>peaks</code></strong>, <strong><code>invent</code></strong>, <strong><code>mapbox_token</code></strong>=<em><code>None</code></em>, <strong><code>month</code></strong>=<em><code>'1908'</code></em>)</p>
</blockquote>
<p>Create map with peaks (marker + capture zone) and inventory
:param peaks: GeoDataFrame, Dataframe containing the peaks we want to display.
:param plants: GeoDataFrame, Dataframe containing all registered plants.
:param plants_coal: GeoDataFrame, Dataframe containing all registered coal plants.
:param cities: GeoDataFrame, Dataframe containing all registered big cities.
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">peaks_capture_map</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">invent</span><span class="p">,</span> <span class="n">mapbox_token</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">35</span><span class="p">]</span><span class="o">.</span><span class="n">sounding_id</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">35</span><span class="p">]</span><span class="o">.</span><span class="n">windspeed_u</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">35</span><span class="p">]</span><span class="o">.</span><span class="n">windspeed_v</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted explorations.ipynb.
Converted index.ipynb.
Converted oco2peak-datasets-points-isoles.ipynb.
Converted oco2peak-datasets.ipynb.
Converted oco2peak-find_peak.ipynb.
Converted oco2peak-map.ipynb.
Converted oco2peak-mapfolium.ipynb.
Converted oco2peak-nc4_convert.ipynb.
Converted oco2peak-swift_utils.ipynb.
Converted oco2peak_find_source.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">folium</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">folium</span><span class="o">.</span><span class="n">_version</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>


